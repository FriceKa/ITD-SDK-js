/**
 * üîÑ –ü—Ä–∏–º–µ—Ä 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
 * 
 * –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏.
 * –í—ã –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ API - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"!
 */

import { ITDClient } from 'itd-sdk-js';
import dotenv from 'dotenv';

dotenv.config();

async function main() {
    console.log('üîÑ === –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ ===\n');

    const client = new ITDClient();
    // –¢–æ–∫–µ–Ω –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ .env –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

    console.log('üí° SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏!');
    console.log('   –í—ã –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ API - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"\n');

    try {
        // –î–µ–ª–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤
        // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫, SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
        // 1. –û–±–Ω–∞—Ä—É–∂–∏—Ç –æ—à–∏–±–∫—É 401
        // 2. –û–±–Ω–æ–≤–∏—Ç —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ refresh endpoint
        // 3. –ü–æ–≤—Ç–æ—Ä–∏—Ç –∑–∞–ø—Ä–æ—Å
        // –í—Å—ë —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

        console.log('üìù –ó–∞–ø—Ä–æ—Å 1: –ü–æ–ª—É—á–∞—é —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å...');
        const profile = await client.getMyProfile();
        console.log(`   ‚úÖ –£—Å–ø–µ—à–Ω–æ! Username: ${profile.username}\n`);

        console.log('üìù –ó–∞–ø—Ä–æ—Å 2: –ü–æ–ª—É—á–∞—é —Å–≤–æ–∏ –ø–æ—Å—Ç—ã...');
        const posts = await client.getMyPosts(5);
        console.log(`   ‚úÖ –£—Å–ø–µ—à–Ω–æ! –ù–∞–π–¥–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: ${posts.posts.length}\n`);

        console.log('üìù –ó–∞–ø—Ä–æ—Å 3: –ü–æ–ª—É—á–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è...');
        const notifications = await client.getNotifications(5);
        if (notifications) {
            console.log(`   ‚úÖ –£—Å–ø–µ—à–Ω–æ! –ù–∞–π–¥–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ${notifications.notifications.length}\n`);
        }

        console.log('üéâ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
        console.log('   –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª—è–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.\n');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω
        console.log('üîç –¢–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω:');
        console.log(`   ${client.accessToken?.substring(0, 50)}...`);

    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error.message);
        console.error('\nüí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:');
        console.error('   1. –í .env —É–∫–∞–∑–∞–Ω ITD_ACCESS_TOKEN');
        console.error('   2. –í .cookies –µ—Å—Ç—å refresh_token cookie');
        console.error('   3. Cookies –Ω–µ –∏—Å—Ç–µ–∫–ª–∏');
    }
}

main();
